(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["CptvPlayerVue"]=t():e["CptvPlayerVue"]=t()})("undefined"!==typeof self?self:this,(function(){return(()=>{var e={8146:(e,t,n)=>{"use strict";var i=n(4489),a=n(7297);let o;class s{constructor(){this.fn=null}unlock(){this.fn&&this.fn()}}const c=function(e,t){const n={offsets:[]};n.bytes=e,n.offset=0;const r=e.byteLength;let i=5;0!==t&&(i=Math.ceil(r/t));const a=r/i;for(let o=0;o<i;o++)n.offsets.push(Math.ceil(a*o));return n.offsets.push(r),{read(){return new Promise((e=>{n.offset+=1;const t=n.bytes.slice(n.offsets[n.offset-1],n.offsets[n.offset]);e({value:t,done:n.offset===n.offsets.length-1})}))},cancel(){return new Promise((e=>{e()}))}}};let d=!1;class u{async initWithCptvUrlAndSize(e,t){const i=new s;await this.lockIsUncontended(i),this.locked=!0,d?d&&this.inited&&(this.playerContext.free(),this.reader&&await this.reader.cancel()):(o=(await n.e(711).then(n.bind(n,6711))).CptvPlayerContext,d=!0);try{if(this.consumed=!1,this.response=await fetch(e),200===this.response.status)return this.reader=this.response.body.getReader(),t||(t=Number(this.response.headers.get("Content-Length"))||0),this.expectedSize=t,this.playerContext=await o.newWithStream(this.reader),i.unlock(),this.inited=!0,this.locked=!1,!0;this.locked=!1;try{const e=await this.response.json();return e.messages&&e.messages.pop()||e.message||"Unknown error"}catch(a){return await r.text()}}catch(a){return this.locked=!1,`Failed to load CPTV url ${e}, ${a}`}}async initWithCptvFile(e){const t=await i.readFile(e),n=(0,a.createRequire)("file:///Users/jon/Dev/Cacophony/cptv-player-vue/node_modules/cptv-decoder/decoder.js"),r=n.resolve("./pkg-node/index_bg.wasm"),o=await i.readFile(r);return this.initWithFileBytes(t,e,o)}async initWithFileBytes(e,t="",r){const i=new s;await this.lockIsUncontended(i),this.locked=!0,d?d&&this.inited&&(this.playerContext.free(),this.reader&&await this.reader.cancel()):(o=a.createRequire?(await n.e(423).then(n.t.bind(n,7423,19))).CptvPlayerContext:(await n.e(711).then(n.bind(n,6711))).CptvPlayerContext,d=!0),this.consumed=!1,this.reader=new c(e,1e5),this.expectedSize=e.length;try{return this.playerContext=await o.newWithStream(this.reader),i.unlock(),this.inited=!0,this.locked=!1,!0}catch(u){return this.locked=!1,`Failed to load CPTV file ${t}, ${u}`}}async fetchNextFrame(){if(!this.reader)return"You need to initialise the player with the url of a CPTV file";if(this.consumed)return"Stream has already been consumed and discarded";const e=new s;await this.lockIsUncontended(e),this.locked=!0,this.playerContext&&this.playerContext.ptr&&(this.playerContext=await o.fetchNextFrame(this.playerContext)),e.unlock(),this.locked=!1;const t=this.playerContext.getNextFrame();if(0===t.length)return null;const n=this.playerContext.getFrameHeader();return{data:new Uint16Array(t),meta:n}}async countTotalFrames(){if(!this.reader)return"You need to initialise the player with the url of a CPTV file";const e=new s;return await this.lockIsUncontended(e),this.locked=!0,this.playerContext&&this.playerContext.ptr&&(this.playerContext=await o.countTotalFrames(this.playerContext),this.consumed=!0),e.unlock(),this.locked=!1,this.getTotalFrames()}async getMetadata(){const e=await this.getHeader(),t=await this.countTotalFrames(),n=1/e.fps*t;return{...e,duration:n}}async getFileMetadata(e){return await this.initWithCptvFile(e,!0),await this.getMetadata()}async getStreamMetadata(e,t){return await this.initWithCptvUrlAndSize(e,t),await this.getMetadata()}async lockIsUncontended(e){return new Promise((t=>{this.locked?e.fn=t:t()}))}async getHeader(){if(!this.reader)return"You need to initialise the player with the url of a CPTV file";const e=new s;await this.lockIsUncontended(e),this.locked=!0,this.playerContext&&this.playerContext.ptr&&(this.playerContext=await o.fetchHeader(this.playerContext));const t=this.playerContext.getHeader();return e.unlock(),this.locked=!1,t}getTotalFrames(){return!this.locked&&this.inited&&this.playerContext.ptr&&this.playerContext.streamComplete()?this.playerContext.totalFrames():null}getLoadProgress(){return!this.locked&&this.playerContext&&this.playerContext.ptr?this.playerContext.bytesLoaded()/this.expectedSize:null}}var f=n(4895);const l=f.parentPort||"undefined"!==typeof self&&self;if(l){const e=new u;l.addEventListener("message",(async({data:t})=>{switch(t.type){case"initWithUrl":{const n=await e.initWithCptvUrlAndSize(t.url);l.postMessage({type:t.type,data:n})}break;case"initWithUrlAndSize":{const n=await e.initWithCptvUrlAndSize(t.url,t.size);l.postMessage({type:t.type,data:n})}break;case"initWithPath":{const n=await e.initWithCptvFile(t.path);l.postMessage({type:t.type,data:n})}break;case"initWithLocalCptvFile":{const n=await e.initWithFileBytes(t.arrayBuffer);l.postMessage({type:t.type,data:n})}break;case"getFileMetadata":{const n=await e.getFileMetadata(t.path);l.postMessage({type:t.type,data:n})}break;case"getStreamMetadata":{const n=await e.getStreamMetadata(t.url);l.postMessage({type:t.type,data:n})}break;case"getNextFrame":{const n=await e.fetchNextFrame();l.postMessage({type:t.type,data:n})}break;case"getTotalFrames":{const n=e.getTotalFrames();l.postMessage({type:t.type,data:n})}break;case"getLoadProgress":{const n=e.getLoadProgress();l.postMessage({type:t.type,data:n})}break;case"getHeader":{const n=await e.getHeader();l.postMessage({type:t.type,data:n})}break;default:return void l.postMessage(t)}}))}},4489:()=>{},7297:()=>{},4895:()=>{}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={id:r,exports:{}};return e[r](a,a.exports,n),a.exports}n.m=e,n.c=t,(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var a=Object.create(null);n.r(a);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>o[e]=()=>r[e]));return o["default"]=()=>r,n.d(a,o),a}})(),(()=>{n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}})(),(()=>{n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[]))})(),(()=>{n.u=e=>"CptvPlayerVue.umd.min."+e+".js"})(),(()=>{n.miniCssF=e=>{}})(),(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{n.p=""})(),(()=>{var e={372:1,146:1},t=t=>{var[r,a,o]=t;for(var s in a)n.o(a,s)&&(n.m[s]=a[s]);o&&o(n);while(r.length)e[r.pop()]=1;i(t)};n.f.i=(t,r)=>{e[t]||importScripts(n.p+n.u(t))};var r=("undefined"!==typeof self?self:this)["webpackChunkCptvPlayerVue"]=("undefined"!==typeof self?self:this)["webpackChunkCptvPlayerVue"]||[],i=r.push.bind(r);r.push=t})(),(()=>{var e,t,r,i,a,o,s,c,d,u,f,l,p,h,_,b,y,w,g,v,x,m,C,k,P,F,S,M,W,j,T,U,O,A,L,V,z,H,I={};var N={1307:function(){return{"./index_bg.js":{__wbindgen_object_drop_ref:function(t){return void 0===e&&(e=n.c[3303].exports),e["ug"](t)},__wbg_new_3ea8490cd276c848:function(e,r){return void 0===t&&(t=n.c[3303].exports),t["fL"](e,r)},__wbindgen_number_new:function(e){return void 0===r&&(r=n.c[3303].exports),r["pT"](e)},__wbg_newwithlength_90fbb2b2d057a3c0:function(e){return void 0===i&&(i=n.c[3303].exports),i["bF"](e)},__wbindgen_memory:function(){return void 0===a&&(a=n.c[3303].exports),a["oH"]()},__wbg_buffer_ebc6c8e75510eae3:function(e){return void 0===o&&(o=n.c[3303].exports),o["v3"](e)},__wbg_newwithbyteoffsetandlength_9eb3327abeac2c52:function(e,t,r){return void 0===s&&(s=n.c[3303].exports),s["MS"](e,t,r)},__wbg_new_68adb0d58759a4ed:function(){return void 0===c&&(c=n.c[3303].exports),c["qq"]()},__wbg_set_2e79e744454afade:function(e,t,r){return void 0===d&&(d=n.c[3303].exports),d["Hl"](e,t,r)},__wbindgen_string_new:function(e,t){return void 0===u&&(u=n.c[3303].exports),u["h4"](e,t)},__wbg_new_59cb74e423758ede:function(){return void 0===f&&(f=n.c[3303].exports),f["h9"]()},__wbg_stack_558ba5917b466edd:function(e,t){return void 0===l&&(l=n.c[3303].exports),l["Dz"](e,t)},__wbg_error_4bb6c2a97407129a:function(e,t){return void 0===p&&(p=n.c[3303].exports),p["kF"](e,t)},__wbg_read_2516fe8e4e56274e:function(e){return void 0===h&&(h=n.c[3303].exports),h["Xy"](e)},__wbg_then_ac66ca61394bfd21:function(e,t,r){return void 0===_&&(_=n.c[3303].exports),_["xI"](e,t,r)},__wbindgen_boolean_get:function(e){return void 0===b&&(b=n.c[3303].exports),b["HT"](e)},__wbindgen_is_undefined:function(e){return void 0===y&&(y=n.c[3303].exports),y["XP"](e)},__wbg_instanceof_Uint8Array_d7349a138407a31e:function(e){return void 0===w&&(w=n.c[3303].exports),w["QP"](e)},__wbg_byteLength_7d55aca7ec6c42cb:function(e){return void 0===g&&(g=n.c[3303].exports),g["tv"](e)},__wbg_length_317f0dd77f7a6673:function(e){return void 0===v&&(v=n.c[3303].exports),v["rX"](e)},__wbg_new_135e963dedf67b22:function(e){return void 0===x&&(x=n.c[3303].exports),x["XV"](e)},__wbg_set_4a5072a31008e0cb:function(e,t,r){return void 0===m&&(m=n.c[3303].exports),m["CV"](e,t,r)},__wbg_cptvplayercontext_new:function(e){return void 0===C&&(C=n.c[3303].exports),C["WA"](e)},__wbg_call_f5e0576f61ee7461:function(e,t,r){return void 0===k&&(k=n.c[3303].exports),k["S8"](e,t,r)},__wbg_get_0c6963cbab34fbb6:function(e,t){return void 0===P&&(P=n.c[3303].exports),P["et"](e,t)},__wbg_new_7031805939a80203:function(e,t){return void 0===F&&(F=n.c[3303].exports),F["SS"](e,t)},__wbindgen_object_clone_ref:function(e){return void 0===S&&(S=n.c[3303].exports),S["m_"](e)},__wbindgen_debug_string:function(e,t){return void 0===M&&(M=n.c[3303].exports),M["fY"](e,t)},__wbindgen_throw:function(e,t){return void 0===W&&(W=n.c[3303].exports),W["Or"](e,t)},__wbg_then_367b3e718069cfb9:function(e,t){return void 0===j&&(j=n.c[3303].exports),j["DN"](e,t)},__wbindgen_cb_drop:function(e){return void 0===T&&(T=n.c[3303].exports),T["G6"](e)},__wbg_resolve_778af3f90b8e2b59:function(e){return void 0===U&&(U=n.c[3303].exports),U["IL"](e)},__wbg_debug_3c0b82934d1dd91e:function(e){return void 0===O&&(O=n.c[3303].exports),O["bf"](e)},__wbg_error_9ff84d33a850b1ef:function(e){return void 0===A&&(A=n.c[3303].exports),A["Qw"](e)},__wbg_info_3b2058a219fa31b9:function(e){return void 0===L&&(L=n.c[3303].exports),L["Jn"](e)},__wbg_log_386a8115a84a780d:function(e){return void 0===V&&(V=n.c[3303].exports),V["IZ"](e)},__wbg_warn_5fc232d538408d4a:function(e){return void 0===z&&(z=n.c[3303].exports),z["QL"](e)},__wbindgen_closure_wrapper211:function(e,t,r){return void 0===H&&(H=n.c[3303].exports),H["LC"](e,t,r)}}}}},B={711:[1307]};n.w={},n.f.wasm=function(e,t){var r=B[e]||[];r.forEach((function(r,i){var a=I[r];if(a)t.push(a);else{var o,s=N[r](),c=fetch(n.p+""+{711:{1307:"14f4ffee421e2ef7349c"}}[e][r]+".module.wasm");if(s instanceof Promise&&"function"===typeof WebAssembly.compileStreaming)o=Promise.all([WebAssembly.compileStreaming(c),s]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"===typeof WebAssembly.instantiateStreaming)o=WebAssembly.instantiateStreaming(c,s);else{var d=c.then((function(e){return e.arrayBuffer()}));o=d.then((function(e){return WebAssembly.instantiate(e,s)}))}t.push(I[r]=o.then((function(e){return n.w[r]=(e.instance||e).exports})))}}))}})();var i=n(8146);return i=i.default,i})()}));
//# sourceMappingURL=CptvPlayerVue.umd.min.372.js.map