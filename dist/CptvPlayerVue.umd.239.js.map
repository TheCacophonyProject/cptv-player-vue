{"version":3,"sources":["webpack://CptvPlayerVue/../cptv-rs/decoder.js","webpack://CptvPlayerVue/../cptv-rs/decoder.worker.js","webpack://CptvPlayerVue/ignored|/Users/jon/Dev/Cacophony/cptv-rs|fs/promises","webpack://CptvPlayerVue/ignored|/Users/jon/Dev/Cacophony/cptv-rs|worker_threads"],"names":["Unlocker","FakeReader","maxChunkSize","state","offsets","length","bytes","numParts","Math","percentages","i","read","value","resolve","done","cancel","initedWasm","CptvDecoderInterface","CptvPlayerContext","unlocker","fetch","size","Number","r","fs","file","filePath","isNode","fileBytes","console","frameData","frameHeader","sameFrameAsPrev","data","meta","header","totalFrameCount","duration","totalFrames","context","parentPort","player","result","type","frame","progress","hasError","error"],"mappings":"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","file":"CptvPlayerVue.umd.239.js","sourcesContent":["let CptvPlayerContext;\n\n/**\n * NOTE: For browser usage, these imports need to be stubbed\n *  out in your webpack config using:\n *\n * resolve: {\n *  fallback: {\n *    fs\n *  }\n * }\n */\n\nimport fs from \"fs/promises\";\n\nclass Unlocker {\n  constructor() {\n    this.fn = null;\n  }\n  unlock() {\n    this.fn && this.fn();\n  }\n}\n\n// For use in nodejs to wrap an already loaded array buffer into a Reader interface\nconst FakeReader = function (bytes, maxChunkSize = 0) {\n  const state = {\n    offsets: []\n  };\n  state.bytes = bytes;\n  state.offset = 0;\n  const length = bytes.byteLength;\n  // How many reader chunks to split the file into\n  let numParts = 5;\n  if (maxChunkSize !== 0) {\n    numParts = Math.ceil(length / maxChunkSize);\n  }\n  const percentages = length / numParts;\n  for (let i = 0; i < numParts; i++) {\n    state.offsets.push(Math.ceil(percentages * i));\n  }\n  state.offsets.push(length);\n  return {\n    read() {\n      return new Promise((resolve) => {\n        state.offset += 1;\n        const value = state.bytes.slice(state.offsets[state.offset - 1], state.offsets[state.offset]);\n        resolve({\n          value,\n          done: state.offset === state.offsets.length - 1\n        });\n      });\n    },\n    cancel() {\n      // Does nothing.\n      return new Promise((resolve) => {\n        resolve()\n      });\n    }\n  }\n};\n\n// TODO(jon): This differs depending on whether the sensor is lepton 3 or 3.5\n// TODO(jon): This is probably out of scope for this library, should be handled\n//  at the player level.\nlet initedWasm = false;\n\nexport class CptvDecoderInterface {\n  async initWasm(isNode) {\n    if (!initedWasm) {\n      if (isNode) {\n        CptvPlayerContext = (await import(\"./pkg-node/index.js\")).CptvPlayerContext;\n      } else {\n        CptvPlayerContext = (await import (\"./pkg/index.js\")).CptvPlayerContext;\n      }\n      initedWasm = true;\n    }\n    else if (initedWasm && this.inited) {\n      this.playerContext.free();\n      this.reader && await this.reader.cancel();\n    }\n  }\n\n  async initWithCptvUrlAndSize(url, size) {\n    const unlocker = new Unlocker();\n    await this.lockIsUncontended(unlocker);\n    this.locked = true;\n    this.framesRead = 0;\n    this.prevFrameHeader = null;\n    this.streamError = undefined;\n    await this.initWasm(false);\n    try {\n      // Use this expired JWT token to test that failure case (usually when a page has been open too long)\n      // const oldJWT = \"https://api.cacophony.org.nz/api/v1/signedUrl?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfdHlwZSI6ImZpbGVEb3dubG9hZCIsImtleSI6InJhdy8yMDIxLzA0LzE1LzQ3MGU2YjY1LWZkOTgtNDk4Ny1iNWQ3LWQyN2MwOWIxODFhYSIsImZpbGVuYW1lIjoiMjAyMTA0MTUtMTE0MjE2LmNwdHYiLCJtaW1lVHlwZSI6ImFwcGxpY2F0aW9uL3gtY3B0diIsImlhdCI6MTYxODQ2MjUwNiwiZXhwIjoxNjE4NDYzMTA2fQ.p3RAOX7Ns52JqHWTMM5Se-Fn-UCyRtX2tveaGrRmiwo\";\n      this.consumed = false;\n      this.response = await fetch(url);\n      if (this.response.status === 200) {\n        this.reader = this.response.body.getReader();\n        if (!size) {\n          size = Number(this.response.headers.get(\"Content-Length\")) || 0;\n        }\n        this.expectedSize = size;\n        this.playerContext = await CptvPlayerContext.newWithStream(this.reader);\n        unlocker.unlock();\n        this.inited = true;\n        this.locked = false;\n        return true;\n      } else {\n        unlocker.unlock();\n        this.locked = false;\n        try {\n          const r = await this.response.json();\n          return (r.messages && r.messages.pop()) || r.message || \"Unknown error\";\n        } catch (e) {\n          return await r.text();\n        }\n      }\n    } catch (e) {\n      this.locked = false;\n      return `Failed to load CPTV url ${url}, ${e}`;\n    }\n  }\n\n  async initWithCptvFile(filePath) {\n    // Don't call this from a browser!\n    const file = await fs.readFile(filePath);\n    return this.initWithFileBytes(file, filePath, true);\n  }\n\n  async initWithFileBytes(fileBytes, filePath = \"\", isNode = false) {\n    // Don't call this from a browser!\n    this.framesRead = 0;\n    this.streamError = undefined;\n    const unlocker = new Unlocker();\n    await this.lockIsUncontended(unlocker);\n    this.prevFrameHeader = null;\n    this.locked = true;\n    await this.initWasm(isNode);\n    this.consumed = false;\n    this.reader = new FakeReader(fileBytes, 100000);\n    this.expectedSize = fileBytes.length;\n    try {\n      this.playerContext = await CptvPlayerContext.newWithStream(this.reader);\n      unlocker.unlock();\n      this.inited = true;\n      this.locked = false;\n      return true;\n    } catch (e) {\n      this.streamError = e;\n      unlocker.unlock();\n      this.locked = false;\n      return `Failed to load CPTV file ${filePath}, ${e}`;\n    }\n  }\n\n  async fetchNextFrame() {\n    if (!this.reader) {\n      console.warn(\"You need to initialise the player with the url of a CPTV file\");\n      return null;\n    }\n    if (this.consumed) {\n      console.warn(\"Stream has already been consumed and discarded\");\n      return null;\n    }\n    const unlocker = new Unlocker();\n    await this.lockIsUncontended(unlocker);\n    this.locked = true;\n    if (this.playerContext && this.playerContext.ptr) {\n      try {\n        this.playerContext = await CptvPlayerContext.fetchNextFrame(this.playerContext);\n      } catch (e) {\n        this.streamError = e;\n      }\n    } else {\n      console.warn(\"Fetch next failed\");\n    }\n    unlocker.unlock();\n    this.locked = false;\n    if (this.hasStreamError()) {\n      return null;\n    }\n    const frameData = this.playerContext.getNextFrame();\n    const frameHeader = this.playerContext.getFrameHeader();\n    // NOTE(jon): Work around a bug where the mlx sensor doesn't report timeOn times, just hardcodes 60000\n    if (frameHeader && frameHeader.imageData.width !== 32) {\n      const sameFrameAsPrev = frameHeader && this.prevFrameHeader && frameHeader.timeOnMs === this.prevFrameHeader.timeOnMs;\n      if (sameFrameAsPrev && this.getTotalFrames() === null) {\n        this.prevFrameHeader = frameHeader;\n        return await this.fetchNextFrame();\n      }\n      this.prevFrameHeader = frameHeader;\n    }\n    if (frameData.length === 0) {\n      return null;\n    }\n    this.framesRead++;\n    return { data: new Uint16Array(frameData), meta: frameHeader };\n  }\n\n  async countTotalFrames() {\n    if (!this.reader) {\n      console.warn(\"You need to initialise the player with the url of a CPTV file\");\n      return 0;\n    }\n    const unlocker = new Unlocker();\n    await this.lockIsUncontended(unlocker);\n    this.locked = true;\n    if (this.playerContext && this.playerContext.ptr) {\n      try {\n        this.playerContext = await CptvPlayerContext.countTotalFrames(this.playerContext);\n      } catch (e) {\n        this.streamError = e;\n      }\n      // We can't call any other methods that read frame data on this stream,\n      // since we've exhausted it and thrown away the data after scanning for the info we want.\n      this.consumed = true;\n    }\n    unlocker.unlock();\n    this.locked = false;\n    return this.getTotalFrames();\n  }\n\n  async getMetadata() {\n    const header = await this.getHeader();\n    let totalFrameCount = 0;\n    if (this.hasStreamError()) {\n      return this.streamError;\n    } else {\n      totalFrameCount = await this.countTotalFrames();\n      const duration = (1 / header.fps) * totalFrameCount;\n      return {\n        ...header,\n        duration,\n        totalFrames: totalFrameCount,\n      }\n    }\n  }\n\n  async getBytesMetadata(fileBytes) {\n    await this.initWithFileBytes(fileBytes, \"\", !!fs);\n    return await this.getMetadata();\n  }\n\n  async getFileMetadata(filePath) {\n    await this.initWithCptvFile(filePath);\n    return await this.getMetadata();\n  }\n\n  async getStreamMetadata(url, size) {\n    await this.initWithCptvUrlAndSize(url, size);\n    return await this.getMetadata();\n  }\n\n  async lockIsUncontended(unlocker) {\n    return new Promise((resolve) => {\n      if (this.locked) {\n        unlocker.fn = resolve;\n      } else {\n        resolve();\n      }\n    });\n  }\n\n  async getHeader() {\n    if (!this.reader) {\n      return \"You need to initialise the player with the url of a CPTV file\";\n    }\n    const unlocker = new Unlocker();\n    await this.lockIsUncontended(unlocker);\n    this.locked = true;\n    if (this.playerContext && this.playerContext.ptr) {\n      this.playerContext = await CptvPlayerContext.fetchHeader(this.playerContext);\n    }\n    if (this.playerContext && this.playerContext.ptr) {\n      const header = this.playerContext.getHeader();\n      if (header === \"Unable to parse header\") {\n        this.streamError = header;\n      }\n      unlocker.unlock();\n      this.locked = false;\n      return header;\n    }\n    return this.streamError;\n  }\n\n  getTotalFrames() {\n    if (this.streamError) {\n      return this.framesRead;\n    }\n    if (!this.locked && this.inited && this.playerContext.ptr && this.playerContext.streamComplete()) {\n      return this.playerContext.totalFrames();\n    }\n    return null;\n  }\n\n  getLoadProgress() {\n    if (this.locked || (!this.playerContext || !this.playerContext.ptr)) {\n      return null;\n    }\n    // This doesn't actually tell us how much has downloaded, just how much has been lazily read.\n    return this.playerContext.bytesLoaded() / this.expectedSize;\n  }\n\n  hasStreamError() {\n    return this.streamError !== undefined;\n  }\n}\n","import {CptvDecoderInterface} from \"./decoder.js\";\nimport {parentPort} from \"worker_threads\";\nconst context = parentPort || (typeof self !== \"undefined\" ? self : false);\nif (context) {\n  const player = new CptvDecoderInterface();\n  context.addEventListener(\"message\", async ({data}) => {\n    switch (data.type) {\n      case \"initWithUrl\": {\n        const result = await player.initWithCptvUrlAndSize(data.url);\n        context.postMessage({type: data.type, data: result});\n      }\n        break;\n      case \"initWithUrlAndSize\": {\n        const result = await player.initWithCptvUrlAndSize(data.url, data.size);\n        context.postMessage({type: data.type, data: result});\n      }\n        break;\n      case \"initWithPath\": {\n        const result = await player.initWithCptvFile(data.path);\n        context.postMessage({type: data.type, data: result});\n      }\n        break;\n      case \"initWithLocalCptvFile\": {\n        const result = await player.initWithFileBytes(data.arrayBuffer);\n        context.postMessage({type: data.type, data: result});\n      }\n        break;\n      case \"getBytesMetadata\": {\n        const header = await player.getBytesMetadata(data.arrayBuffer);\n        context.postMessage({type: data.type, data: header});\n      }\n        break;\n      case \"getFileMetadata\": {\n        const header = await player.getFileMetadata(data.path);\n        context.postMessage({type: data.type, data: header});\n      }\n        break;\n      case \"getStreamMetadata\": {\n        const header = await player.getStreamMetadata(data.url);\n        context.postMessage({type: data.type, data: header});\n      }\n        break;\n      case \"getNextFrame\": {\n        const frame = await player.fetchNextFrame();\n        context.postMessage({type: data.type, data: frame});\n      }\n        break;\n      case \"getTotalFrames\": {\n        const totalFrames = player.getTotalFrames();\n        context.postMessage({type: data.type, data: totalFrames});\n      }\n        break;\n      case \"getLoadProgress\": {\n        const progress = player.getLoadProgress();\n        context.postMessage({type: data.type, data: progress});\n      }\n        break;\n      case \"getHeader\": {\n        const header = await player.getHeader();\n        context.postMessage({type: data.type, data: header});\n      }\n        break\n      case \"hasStreamError\": {\n        const hasError = player.hasStreamError();\n        context.postMessage({type: data.type, data: hasError });\n      }\n        break;\n      case \"getStreamError\": {\n        const error = player.streamError;\n        context.postMessage({type: data.type, data: error });\n      }\n        break;\n      default:\n        context.postMessage(data);\n        return;\n    }\n  });\n}\nexport default () => {\n  return false;\n};\n","/* (ignored) */","/* (ignored) */"],"sourceRoot":""}