(("undefined"!==typeof self?self:this)["webpackChunkCptvPlayerVue"]=("undefined"!==typeof self?self:this)["webpackChunkCptvPlayerVue"]||[]).push([[251],{3251:(e,t,n)=>{"use strict";n(5666);var a,s=n(6174),i=(n(1539),n(8674),n(7042),n(6992),n(8783),n(3948),n(9653),n(2222),n(8255),n(2990),n(8927),n(3105),n(5035),n(4345),n(7174),n(2846),n(4731),n(7209),n(6319),n(8867),n(7789),n(3739),n(9368),n(4483),n(2056),n(3462),n(678),n(7462),n(3824),n(5021),n(2974),n(5016),n(6288)),u=n(3439),o=n(8797),c=n(8740),p=n(5811),h=function(){function e(){(0,u.Z)(this,e),this.fn=null}return(0,o.Z)(e,[{key:"unlock",value:function(){this.fn&&this.fn()}}]),e}(),l=function(e,t){var r={offsets:[]};r.bytes=e,r.offset=0;var n=e.byteLength,a=5;0!==t&&(a=Math.ceil(n/t));for(var s=n/a,i=0;i<a;i++)r.offsets.push(Math.ceil(s*i));return r.offsets.push(n),{read:function(){return new Promise((function(e){r.offset+=1;var t=r.bytes.slice(r.offsets[r.offset-1],r.offsets[r.offset]);e({value:t,done:r.offset===r.offsets.length-1})}))},cancel:function(){return new Promise((function(e){e()}))}}},d=!1,f=function(){function e(){(0,u.Z)(this,e)}return(0,o.Z)(e,[{key:"initWithCptvUrlAndSize",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t,s){var i,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=new h,e.next=3,this.lockIsUncontended(i);case 3:if(this.locked=!0,d){e.next=11;break}return e.next=7,n.e(506).then(n.bind(n,6506));case 7:a=e.sent.CptvPlayerContext,d=!0,e.next=17;break;case 11:if(!d||!this.inited){e.next=17;break}if(this.playerContext.free(),e.t0=this.reader,!e.t0){e.next=17;break}return e.next=17,this.reader.cancel();case 17:return e.prev=17,this.consumed=!1,e.next=21,fetch(t);case 21:if(this.response=e.sent,200!==this.response.status){e.next=35;break}return this.reader=this.response.body.getReader(),s||(s=Number(this.response.headers.get("Content-Length"))||0),this.expectedSize=s,e.next=28,a.newWithStream(this.reader);case 28:return this.playerContext=e.sent,i.unlock(),this.inited=!0,this.locked=!1,e.abrupt("return",!0);case 35:return this.locked=!1,e.prev=36,e.next=39,this.response.json();case 39:return u=e.sent,e.abrupt("return",u.messages&&u.messages.pop()||u.message||"Unknown error");case 43:return e.prev=43,e.t1=e["catch"](36),e.next=47,r.text();case 47:return e.abrupt("return",e.sent);case 48:e.next=54;break;case 50:return e.prev=50,e.t2=e["catch"](17),this.locked=!1,e.abrupt("return","Failed to load CPTV url ".concat(t,", ").concat(e.t2));case 54:case"end":return e.stop()}}),e,this,[[17,50],[36,43]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"initWithCptvFile",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r,n,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c.readFile(t);case 2:return r=e.sent,n=(0,p.createRequire)("file:///Users/jon/Dev/Cacophony/cptv-rs/decoder.js"),a=n.resolve("./pkg-node/index_bg.wasm"),e.next=7,c.readFile(a);case 7:return s=e.sent,e.abrupt("return",this.initWithFileBytes(r,t,s));case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"initWithFileBytes",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r,s,i,u=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:"",u.length>2?u[2]:void 0,s=new h,e.next=5,this.lockIsUncontended(s);case 5:if(this.locked=!0,d){e.next=18;break}if("undefined"!==typeof window){e.next=12;break}i=(0,p.createRequire)("file:///Users/jon/Dev/Cacophony/cptv-rs/decoder.js"),a=i("./pkg-node").CptvPlayerContext,e.next=15;break;case 12:return e.next=14,n.e(506).then(n.bind(n,6506));case 14:a=e.sent.CptvPlayerContext;case 15:d=!0,e.next=24;break;case 18:if(!d||!this.inited){e.next=24;break}if(this.playerContext.free(),e.t0=this.reader,!e.t0){e.next=24;break}return e.next=24,this.reader.cancel();case 24:return this.consumed=!1,this.reader=new l(t,1e5),this.expectedSize=t.length,e.prev=27,e.next=30,a.newWithStream(this.reader);case 30:return this.playerContext=e.sent,s.unlock(),this.inited=!0,this.locked=!1,e.abrupt("return",!0);case 37:return e.prev=37,e.t1=e["catch"](27),this.locked=!1,e.abrupt("return","Failed to load CPTV file ".concat(r,", ").concat(e.t1));case 41:case"end":return e.stop()}}),e,this,[[27,37]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"fetchNextFrame",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.reader){e.next=2;break}return e.abrupt("return","You need to initialise the player with the url of a CPTV file");case 2:if(!this.consumed){e.next=4;break}return e.abrupt("return","Stream has already been consumed and discarded");case 4:return t=new h,e.next=7,this.lockIsUncontended(t);case 7:if(this.locked=!0,!this.playerContext||!this.playerContext.ptr){e.next=12;break}return e.next=11,a.fetchNextFrame(this.playerContext);case 11:this.playerContext=e.sent;case 12:if(t.unlock(),this.locked=!1,r=this.playerContext.getNextFrame(),0!==r.length){e.next=17;break}return e.abrupt("return",null);case 17:return n=this.playerContext.getFrameHeader(),e.abrupt("return",{data:new Uint16Array(r),meta:n});case 19:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"countTotalFrames",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.reader){e.next=2;break}return e.abrupt("return","You need to initialise the player with the url of a CPTV file");case 2:return t=new h,e.next=5,this.lockIsUncontended(t);case 5:if(this.locked=!0,!this.playerContext||!this.playerContext.ptr){e.next=11;break}return e.next=9,a.countTotalFrames(this.playerContext);case 9:this.playerContext=e.sent,this.consumed=!0;case 11:return t.unlock(),this.locked=!1,e.abrupt("return",this.getTotalFrames());case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getMetadata",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getHeader();case 2:return t=e.sent,e.next=5,this.countTotalFrames();case 5:return r=e.sent,n=1/t.fps*r,e.abrupt("return",(0,i.Z)((0,i.Z)({},t),{},{duration:n}));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileMetadata",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.initWithCptvFile(t,!0);case 2:return e.next=4,this.getMetadata();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getStreamMetadata",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.initWithCptvUrlAndSize(t,r);case 2:return e.next=4,this.getMetadata();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"lockIsUncontended",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){r.locked?t.fn=e:e()})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getHeader",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.reader){e.next=2;break}return e.abrupt("return","You need to initialise the player with the url of a CPTV file");case 2:return t=new h,e.next=5,this.lockIsUncontended(t);case 5:if(this.locked=!0,!this.playerContext||!this.playerContext.ptr){e.next=10;break}return e.next=9,a.fetchHeader(this.playerContext);case 9:this.playerContext=e.sent;case 10:return r=this.playerContext.getHeader(),t.unlock(),this.locked=!1,e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getTotalFrames",value:function(){return!this.locked&&this.inited&&this.playerContext.ptr&&this.playerContext.streamComplete()?this.playerContext.totalFrames():null}},{key:"getLoadProgress",value:function(){return!this.locked&&this.playerContext&&this.playerContext.ptr?this.playerContext.bytesLoaded()/this.expectedSize:null}}]),e}(),x=n(4182),y=x.parentPort||"undefined"!==typeof self&&self;if(y){var k=new f;y.addEventListener("message",function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r,n,a,s,i,u,o,c,p,h,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=t.data,e.t0=r.type,e.next="initWithUrl"===e.t0?4:"initWithUrlAndSize"===e.t0?9:"initWithPath"===e.t0?14:"initWithLocalCptvFile"===e.t0?19:"getFileMetadata"===e.t0?24:"getStreamMetadata"===e.t0?29:"getNextFrame"===e.t0?34:"getTotalFrames"===e.t0?39:"getLoadProgress"===e.t0?42:"getHeader"===e.t0?45:50;break;case 4:return e.next=6,k.initWithCptvUrlAndSize(r.url);case 6:return n=e.sent,y.postMessage({type:r.type,data:n}),e.abrupt("break",52);case 9:return e.next=11,k.initWithCptvUrlAndSize(r.url,r.size);case 11:return a=e.sent,y.postMessage({type:r.type,data:a}),e.abrupt("break",52);case 14:return e.next=16,k.initWithCptvFile(r.path);case 16:return s=e.sent,y.postMessage({type:r.type,data:s}),e.abrupt("break",52);case 19:return e.next=21,k.initWithFileBytes(r.arrayBuffer);case 21:return i=e.sent,y.postMessage({type:r.type,data:i}),e.abrupt("break",52);case 24:return e.next=26,k.getFileMetadata(r.path);case 26:return u=e.sent,y.postMessage({type:r.type,data:u}),e.abrupt("break",52);case 29:return e.next=31,k.getStreamMetadata(r.url);case 31:return o=e.sent,y.postMessage({type:r.type,data:o}),e.abrupt("break",52);case 34:return e.next=36,k.fetchNextFrame();case 36:return c=e.sent,y.postMessage({type:r.type,data:c}),e.abrupt("break",52);case 39:return p=k.getTotalFrames(),y.postMessage({type:r.type,data:p}),e.abrupt("break",52);case 42:return h=k.getLoadProgress(),y.postMessage({type:r.type,data:h}),e.abrupt("break",52);case 45:return e.next=47,k.getHeader();case 47:return l=e.sent,y.postMessage({type:r.type,data:l}),e.abrupt("break",52);case 50:return y.postMessage(r),e.abrupt("return");case 52:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},8740:()=>{},5811:()=>{},4182:()=>{}}]);
//# sourceMappingURL=CptvPlayerVue.umd.min.251.js.map