(("undefined"!==typeof self?self:this)["webpackChunkCptvPlayerVue"]=("undefined"!==typeof self?self:this)["webpackChunkCptvPlayerVue"]||[]).push([[251],{3251:(e,t,n)=>{"use strict";n(5666);var a,s=n(6174),i=(n(1539),n(8674),n(7042),n(6992),n(8783),n(3948),n(9653),n(2222),n(8255),n(2990),n(8927),n(3105),n(5035),n(4345),n(7174),n(2846),n(4731),n(7209),n(6319),n(8867),n(7789),n(3739),n(9368),n(4483),n(2056),n(3462),n(678),n(7462),n(3824),n(5021),n(2974),n(5016),n(6288)),u=n(3439),c=n(8797),o=n(8740),p=n(5811),h=function(){function e(){(0,u.Z)(this,e),this.fn=null}return(0,c.Z)(e,[{key:"unlock",value:function(){this.fn&&this.fn()}}]),e}(),l=function(e,t){var r={offsets:[]};r.bytes=e,r.offset=0;var n=e.byteLength,a=5;0!==t&&(a=Math.ceil(n/t));for(var s=n/a,i=0;i<a;i++)r.offsets.push(Math.ceil(s*i));return r.offsets.push(n),{read:function(){return new Promise((function(e){r.offset+=1;var t=r.bytes.slice(r.offsets[r.offset-1],r.offsets[r.offset]);e({value:t,done:r.offset===r.offsets.length-1})}))},cancel:function(){return new Promise((function(e){e()}))}}},d=!1,f=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"initWithCptvUrlAndSize",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t,s){var i,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=new h,e.next=3,this.lockIsUncontended(i);case 3:if(this.locked=!0,this.prevFrameHeader=null,d){e.next=12;break}return e.next=8,n.e(506).then(n.bind(n,6506));case 8:a=e.sent.CptvPlayerContext,d=!0,e.next=18;break;case 12:if(!d||!this.inited){e.next=18;break}if(this.playerContext.free(),e.t0=this.reader,!e.t0){e.next=18;break}return e.next=18,this.reader.cancel();case 18:return e.prev=18,this.consumed=!1,e.next=22,fetch(t);case 22:if(this.response=e.sent,200!==this.response.status){e.next=36;break}return this.reader=this.response.body.getReader(),s||(s=Number(this.response.headers.get("Content-Length"))||0),this.expectedSize=s,e.next=29,a.newWithStream(this.reader);case 29:return this.playerContext=e.sent,i.unlock(),this.inited=!0,this.locked=!1,e.abrupt("return",!0);case 36:return this.locked=!1,e.prev=37,e.next=40,this.response.json();case 40:return u=e.sent,e.abrupt("return",u.messages&&u.messages.pop()||u.message||"Unknown error");case 44:return e.prev=44,e.t1=e["catch"](37),e.next=48,r.text();case 48:return e.abrupt("return",e.sent);case 49:e.next=55;break;case 51:return e.prev=51,e.t2=e["catch"](18),this.locked=!1,e.abrupt("return","Failed to load CPTV url ".concat(t,", ").concat(e.t2));case 55:case"end":return e.stop()}}),e,this,[[18,51],[37,44]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"initWithCptvFile",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o.readFile(t);case 2:return r=e.sent,e.abrupt("return",this.initWithFileBytes(r,t));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"initWithFileBytes",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r,s,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:"",i.length>2?i[2]:void 0,s=new h,e.next=5,this.lockIsUncontended(s);case 5:if(this.prevFrameHeader=null,this.locked=!0,d){e.next=20;break}if(!p.createRequire){e.next=14;break}return e.next=11,n.e(9).then(n.t.bind(n,5009,19));case 11:a=e.sent.CptvPlayerContext,e.next=17;break;case 14:return e.next=16,n.e(506).then(n.bind(n,6506));case 16:a=e.sent.CptvPlayerContext;case 17:d=!0,e.next=26;break;case 20:if(!d||!this.inited){e.next=26;break}if(this.playerContext.free(),e.t0=this.reader,!e.t0){e.next=26;break}return e.next=26,this.reader.cancel();case 26:return this.consumed=!1,this.reader=new l(t,1e5),this.expectedSize=t.length,e.prev=29,e.next=32,a.newWithStream(this.reader);case 32:return this.playerContext=e.sent,s.unlock(),this.inited=!0,this.locked=!1,e.abrupt("return",!0);case 39:return e.prev=39,e.t1=e["catch"](29),this.locked=!1,e.abrupt("return","Failed to load CPTV file ".concat(r,", ").concat(e.t1));case 43:case"end":return e.stop()}}),e,this,[[29,39]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"fetchNextFrame",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t,r,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.reader){e.next=2;break}return e.abrupt("return","You need to initialise the player with the url of a CPTV file");case 2:if(!this.consumed){e.next=4;break}return e.abrupt("return","Stream has already been consumed and discarded");case 4:return t=new h,e.next=7,this.lockIsUncontended(t);case 7:if(this.locked=!0,!this.playerContext||!this.playerContext.ptr){e.next=21;break}return e.prev=9,e.next=12,a.fetchNextFrame(this.playerContext);case 12:this.playerContext=e.sent,e.next=19;break;case 15:return e.prev=15,e.t0=e["catch"](9),this.streamError=e.t0,e.abrupt("return",null);case 19:e.next=22;break;case 21:console.warn("Fetch next failed");case 22:if(t.unlock(),this.locked=!1,r=this.playerContext.getNextFrame(),n=this.playerContext.getFrameHeader(),s=n&&this.prevFrameHeader&&n.timeOnMs===this.prevFrameHeader.timeOnMs,!s||null!==this.getTotalFrames()){e.next=32;break}return this.prevFrameHeader=n,e.next=31,this.fetchNextFrame();case 31:return e.abrupt("return",e.sent);case 32:if(this.prevFrameHeader=n,0!==r.length){e.next=35;break}return e.abrupt("return",null);case 35:return e.abrupt("return",{data:new Uint16Array(r),meta:n});case 36:case"end":return e.stop()}}),e,this,[[9,15]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"countTotalFrames",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.reader){e.next=2;break}return e.abrupt("return","You need to initialise the player with the url of a CPTV file");case 2:return t=new h,e.next=5,this.lockIsUncontended(t);case 5:if(this.locked=!0,!this.playerContext||!this.playerContext.ptr){e.next=11;break}return e.next=9,a.countTotalFrames(this.playerContext);case 9:this.playerContext=e.sent,this.consumed=!0;case 11:return t.unlock(),this.locked=!1,e.abrupt("return",this.getTotalFrames());case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getMetadata",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getHeader();case 2:return t=e.sent,e.next=5,this.countTotalFrames();case 5:return r=e.sent,n=1/t.fps*r,e.abrupt("return",(0,i.Z)((0,i.Z)({},t),{},{duration:n,totalFrames:r}));case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getFileMetadata",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.initWithCptvFile(t,!0);case 2:return e.next=4,this.getMetadata();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getStreamMetadata",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.initWithCptvUrlAndSize(t,r);case 2:return e.next=4,this.getMetadata();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"lockIsUncontended",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){r.locked?t.fn=e:e()})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getHeader",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.reader){e.next=2;break}return e.abrupt("return","You need to initialise the player with the url of a CPTV file");case 2:return t=new h,e.next=5,this.lockIsUncontended(t);case 5:if(this.locked=!0,!this.playerContext||!this.playerContext.ptr){e.next=10;break}return e.next=9,a.fetchHeader(this.playerContext);case 9:this.playerContext=e.sent;case 10:return r=this.playerContext.getHeader(),t.unlock(),this.locked=!1,e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getTotalFrames",value:function(){return this.streamError?1:!this.locked&&this.inited&&this.playerContext.ptr&&this.playerContext.streamComplete()?this.playerContext.totalFrames():null}},{key:"getLoadProgress",value:function(){return!this.locked&&this.playerContext&&this.playerContext.ptr?this.playerContext.bytesLoaded()/this.expectedSize:null}},{key:"hasStreamError",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0!==this.streamError);case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}]),e}(),x=n(4182),y=x.parentPort||"undefined"!==typeof self&&self;if(y){var k=new f;y.addEventListener("message",function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r,n,a,s,i,u,c,o,p,h,l,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=t.data,e.t0=r.type,e.next="initWithUrl"===e.t0?4:"initWithUrlAndSize"===e.t0?9:"initWithPath"===e.t0?14:"initWithLocalCptvFile"===e.t0?19:"getFileMetadata"===e.t0?24:"getStreamMetadata"===e.t0?29:"getNextFrame"===e.t0?34:"getTotalFrames"===e.t0?39:"getLoadProgress"===e.t0?42:"getHeader"===e.t0?45:"hasStreamError"===e.t0?50:55;break;case 4:return e.next=6,k.initWithCptvUrlAndSize(r.url);case 6:return n=e.sent,y.postMessage({type:r.type,data:n}),e.abrupt("break",57);case 9:return e.next=11,k.initWithCptvUrlAndSize(r.url,r.size);case 11:return a=e.sent,y.postMessage({type:r.type,data:a}),e.abrupt("break",57);case 14:return e.next=16,k.initWithCptvFile(r.path);case 16:return s=e.sent,y.postMessage({type:r.type,data:s}),e.abrupt("break",57);case 19:return e.next=21,k.initWithFileBytes(r.arrayBuffer);case 21:return i=e.sent,y.postMessage({type:r.type,data:i}),e.abrupt("break",57);case 24:return e.next=26,k.getFileMetadata(r.path);case 26:return u=e.sent,y.postMessage({type:r.type,data:u}),e.abrupt("break",57);case 29:return e.next=31,k.getStreamMetadata(r.url);case 31:return c=e.sent,y.postMessage({type:r.type,data:c}),e.abrupt("break",57);case 34:return e.next=36,k.fetchNextFrame();case 36:return o=e.sent,y.postMessage({type:r.type,data:o}),e.abrupt("break",57);case 39:return p=k.getTotalFrames(),y.postMessage({type:r.type,data:p}),e.abrupt("break",57);case 42:return h=k.getLoadProgress(),y.postMessage({type:r.type,data:h}),e.abrupt("break",57);case 45:return e.next=47,k.getHeader();case 47:return l=e.sent,y.postMessage({type:r.type,data:l}),e.abrupt("break",57);case 50:return e.next=52,k.hasStreamError();case 52:return d=e.sent,y.postMessage({type:r.type,data:d}),e.abrupt("break",57);case 55:return y.postMessage(r),e.abrupt("return");case 57:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},8740:()=>{},5811:()=>{},4182:()=>{}}]);
//# sourceMappingURL=CptvPlayerVue.umd.min.251.js.map