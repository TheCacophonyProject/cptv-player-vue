(("undefined"!==typeof self?self:this)["webpackChunkCptvPlayerVue"]=("undefined"!==typeof self?self:this)["webpackChunkCptvPlayerVue"]||[]).push([[251],{3251:(e,t,n)=>{"use strict";n(5666);var a,s=n(6174),i=(n(1539),n(8674),n(7042),n(6992),n(8783),n(3948),n(9653),n(2222),n(8255),n(2990),n(8927),n(3105),n(5035),n(4345),n(7174),n(2846),n(4731),n(7209),n(6319),n(8867),n(7789),n(3739),n(9368),n(4483),n(2056),n(3462),n(678),n(7462),n(3824),n(5021),n(2974),n(5016),n(6288)),u=n(3439),o=n(8797),c=n(8740),h=function(){function e(){(0,u.Z)(this,e),this.fn=null}return(0,o.Z)(e,[{key:"unlock",value:function(){this.fn&&this.fn()}}]),e}(),p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r={offsets:[]};r.bytes=e,r.offset=0;var n=e.byteLength,a=5;0!==t&&(a=Math.ceil(n/t));for(var s=n/a,i=0;i<a;i++)r.offsets.push(Math.ceil(s*i));return r.offsets.push(n),{read:function(){return new Promise((function(e){r.offset+=1;var t=r.bytes.slice(r.offsets[r.offset-1],r.offsets[r.offset]);e({value:t,done:r.offset===r.offsets.length-1})}))},cancel:function(){return new Promise((function(e){e()}))}}},l=!1,d=function(){function e(){(0,u.Z)(this,e)}return(0,o.Z)(e,[{key:"initWasm",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(l){e.next=13;break}if(!t){e.next=7;break}return e.next=4,n.e(9).then(n.t.bind(n,5009,19));case 4:a=e.sent.CptvPlayerContext,e.next=10;break;case 7:return e.next=9,n.e(506).then(n.bind(n,6506));case 9:a=e.sent.CptvPlayerContext;case 10:l=!0,e.next=19;break;case 13:if(!l||!this.inited){e.next=19;break}if(this.playerContext.free(),e.t0=this.reader,!e.t0){e.next=19;break}return e.next=19,this.reader.cancel();case 19:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"initWithCptvUrlAndSize",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t,n){var s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=new h,e.next=3,this.lockIsUncontended(s);case 3:return this.locked=!0,this.framesRead=0,this.prevFrameHeader=null,this.streamError=void 0,e.next=9,this.initWasm(!1);case 9:return e.prev=9,this.consumed=!1,e.next=13,fetch(t);case 13:if(this.response=e.sent,200!==this.response.status){e.next=27;break}return this.reader=this.response.body.getReader(),n||(n=Number(this.response.headers.get("Content-Length"))||0),this.expectedSize=n,e.next=20,a.newWithStream(this.reader);case 20:return this.playerContext=e.sent,s.unlock(),this.inited=!0,this.locked=!1,e.abrupt("return",!0);case 27:return s.unlock(),this.locked=!1,e.prev=29,e.next=32,this.response.json();case 32:return i=e.sent,e.abrupt("return",i.messages&&i.messages.pop()||i.message||"Unknown error");case 36:return e.prev=36,e.t0=e["catch"](29),e.next=40,r.text();case 40:return e.abrupt("return",e.sent);case 41:e.next=47;break;case 43:return e.prev=43,e.t1=e["catch"](9),this.locked=!1,e.abrupt("return","Failed to load CPTV url ".concat(t,", ").concat(e.t1));case 47:case"end":return e.stop()}}),e,this,[[9,43],[29,36]])})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"initWithCptvFile",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c.readFile(t);case 2:return r=e.sent,e.abrupt("return",this.initWithFileBytes(r,t,!0));case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"initWithFileBytes",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r,n,s,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:"",n=i.length>2&&void 0!==i[2]&&i[2],this.framesRead=0,this.streamError=void 0,s=new h,e.next=7,this.lockIsUncontended(s);case 7:return this.prevFrameHeader=null,this.locked=!0,e.next=11,this.initWasm(n);case 11:return this.consumed=!1,this.reader=new p(t,1e5),this.expectedSize=t.length,e.prev=14,e.next=17,a.newWithStream(this.reader);case 17:return this.playerContext=e.sent,s.unlock(),this.inited=!0,this.locked=!1,e.abrupt("return",!0);case 24:return e.prev=24,e.t0=e["catch"](14),this.streamError=e.t0,s.unlock(),this.locked=!1,e.abrupt("return","Failed to load CPTV file ".concat(r,", ").concat(e.t0));case 30:case"end":return e.stop()}}),e,this,[[14,24]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"fetchNextFrame",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t,r,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.reader){e.next=3;break}return console.warn("You need to initialise the player with the url of a CPTV file"),e.abrupt("return",null);case 3:if(!this.consumed){e.next=6;break}return console.warn("Stream has already been consumed and discarded"),e.abrupt("return",null);case 6:return t=new h,e.next=9,this.lockIsUncontended(t);case 9:if(this.locked=!0,!this.playerContext||!this.playerContext.ptr){e.next=22;break}return e.prev=11,e.next=14,a.fetchNextFrame(this.playerContext);case 14:this.playerContext=e.sent,e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](11),this.streamError=e.t0;case 20:e.next=23;break;case 22:console.warn("Fetch next failed");case 23:if(t.unlock(),this.locked=!1,!this.hasStreamError()){e.next=27;break}return e.abrupt("return",null);case 27:if(r=this.playerContext.getNextFrame(),n=this.playerContext.getFrameHeader(),!n||32===n.imageData.width){e.next=37;break}if(s=n&&this.prevFrameHeader&&n.timeOnMs===this.prevFrameHeader.timeOnMs,!s||null!==this.getTotalFrames()){e.next=36;break}return this.prevFrameHeader=n,e.next=35,this.fetchNextFrame();case 35:return e.abrupt("return",e.sent);case 36:this.prevFrameHeader=n;case 37:if(0!==r.length){e.next=39;break}return e.abrupt("return",null);case 39:return this.framesRead++,e.abrupt("return",{data:new Uint16Array(r),meta:n});case 41:case"end":return e.stop()}}),e,this,[[11,17]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"countTotalFrames",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.reader){e.next=3;break}return console.warn("You need to initialise the player with the url of a CPTV file"),e.abrupt("return",0);case 3:return t=new h,e.next=6,this.lockIsUncontended(t);case 6:if(this.locked=!0,!this.playerContext||!this.playerContext.ptr){e.next=18;break}return e.prev=8,e.next=11,a.countTotalFrames(this.playerContext);case 11:this.playerContext=e.sent,e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](8),this.streamError=e.t0;case 17:this.consumed=!0;case 18:return t.unlock(),this.locked=!1,e.abrupt("return",this.getTotalFrames());case 21:case"end":return e.stop()}}),e,this,[[8,14]])})));function t(){return e.apply(this,arguments)}return t}()},{key:"getMetadata",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getHeader();case 2:if(t=e.sent,r=0,!this.hasStreamError()){e.next=8;break}return e.abrupt("return",this.streamError);case 8:return e.next=10,this.countTotalFrames();case 10:return r=e.sent,n=1/t.fps*r,e.abrupt("return",(0,i.Z)((0,i.Z)({},t),{},{duration:n,totalFrames:r}));case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getBytesMetadata",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.initWithFileBytes(t,"",!!c);case 2:return e.next=4,this.getMetadata();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFileMetadata",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.initWithCptvFile(t);case 2:return e.next=4,this.getMetadata();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getStreamMetadata",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t,r){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.initWithCptvUrlAndSize(t,r);case 2:return e.next=4,this.getMetadata();case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}()},{key:"lockIsUncontended",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){r.locked?t.fn=e:e()})));case 1:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getHeader",value:function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.reader){e.next=2;break}return e.abrupt("return","You need to initialise the player with the url of a CPTV file");case 2:return t=new h,e.next=5,this.lockIsUncontended(t);case 5:if(this.locked=!0,!this.playerContext||!this.playerContext.ptr){e.next=10;break}return e.next=9,a.fetchHeader(this.playerContext);case 9:this.playerContext=e.sent;case 10:if(!this.playerContext||!this.playerContext.ptr){e.next=16;break}return r=this.playerContext.getHeader(),"Unable to parse header"===r&&(this.streamError=r),t.unlock(),this.locked=!1,e.abrupt("return",r);case 16:return e.abrupt("return",this.streamError);case 17:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getTotalFrames",value:function(){return this.streamError?this.framesRead:!this.locked&&this.inited&&this.playerContext.ptr&&this.playerContext.streamComplete()?this.playerContext.totalFrames():null}},{key:"getLoadProgress",value:function(){return!this.locked&&this.playerContext&&this.playerContext.ptr?this.playerContext.bytesLoaded()/this.expectedSize:null}},{key:"hasStreamError",value:function(){return void 0!==this.streamError}}]),e}(),f=n(4182),x=f.parentPort||"undefined"!==typeof self&&self;if(x){var m=new d;x.addEventListener("message",function(){var e=(0,s.Z)(regeneratorRuntime.mark((function e(t){var r,n,a,s,i,u,o,c,h,p,l,d,f,y;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=t.data,e.t0=r.type,e.next="initWithUrl"===e.t0?4:"initWithUrlAndSize"===e.t0?9:"initWithPath"===e.t0?14:"initWithLocalCptvFile"===e.t0?19:"getBytesMetadata"===e.t0?24:"getFileMetadata"===e.t0?29:"getStreamMetadata"===e.t0?34:"getNextFrame"===e.t0?39:"getTotalFrames"===e.t0?44:"getLoadProgress"===e.t0?47:"getHeader"===e.t0?50:"hasStreamError"===e.t0?55:"getStreamError"===e.t0?58:61;break;case 4:return e.next=6,m.initWithCptvUrlAndSize(r.url);case 6:return n=e.sent,x.postMessage({type:r.type,data:n}),e.abrupt("break",63);case 9:return e.next=11,m.initWithCptvUrlAndSize(r.url,r.size);case 11:return a=e.sent,x.postMessage({type:r.type,data:a}),e.abrupt("break",63);case 14:return e.next=16,m.initWithCptvFile(r.path);case 16:return s=e.sent,x.postMessage({type:r.type,data:s}),e.abrupt("break",63);case 19:return e.next=21,m.initWithFileBytes(r.arrayBuffer);case 21:return i=e.sent,x.postMessage({type:r.type,data:i}),e.abrupt("break",63);case 24:return e.next=26,m.getBytesMetadata(r.arrayBuffer);case 26:return u=e.sent,x.postMessage({type:r.type,data:u}),e.abrupt("break",63);case 29:return e.next=31,m.getFileMetadata(r.path);case 31:return o=e.sent,x.postMessage({type:r.type,data:o}),e.abrupt("break",63);case 34:return e.next=36,m.getStreamMetadata(r.url);case 36:return c=e.sent,x.postMessage({type:r.type,data:c}),e.abrupt("break",63);case 39:return e.next=41,m.fetchNextFrame();case 41:return h=e.sent,x.postMessage({type:r.type,data:h}),e.abrupt("break",63);case 44:return p=m.getTotalFrames(),x.postMessage({type:r.type,data:p}),e.abrupt("break",63);case 47:return l=m.getLoadProgress(),x.postMessage({type:r.type,data:l}),e.abrupt("break",63);case 50:return e.next=52,m.getHeader();case 52:return d=e.sent,x.postMessage({type:r.type,data:d}),e.abrupt("break",63);case 55:return f=m.hasStreamError(),x.postMessage({type:r.type,data:f}),e.abrupt("break",63);case 58:return y=m.streamError,x.postMessage({type:r.type,data:y}),e.abrupt("break",63);case 61:return x.postMessage(r),e.abrupt("return");case 63:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},8740:()=>{},4182:()=>{}}]);
//# sourceMappingURL=CptvPlayerVue.umd.min.251.js.map