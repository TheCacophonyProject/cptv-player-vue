(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["CptvPlayerVue"]=t():e["CptvPlayerVue"]=t()})("undefined"!==typeof self?self:this,(function(){return(()=>{var e={8146:(e,t,n)=>{"use strict";var a=n(4489);let i;class s{constructor(){this.fn=null}unlock(){this.fn&&this.fn()}}const o=function(e,t=0){const r={offsets:[]};r.bytes=e,r.offset=0;const n=e.byteLength;let a=5;0!==t&&(a=Math.ceil(n/t));const i=n/a;for(let s=0;s<a;s++)r.offsets.push(Math.ceil(i*s));return r.offsets.push(n),{read(){return new Promise((e=>{r.offset+=1;const t=r.bytes.slice(r.offsets[r.offset-1],r.offsets[r.offset]);e({value:t,done:r.offset===r.offsets.length-1})}))},cancel(){return new Promise((e=>{e()}))}}};let c=!1;class d{async initWasm(){c?c&&this.inited&&(this.playerContext.free(),this.reader&&await this.reader.cancel()):(i=a?(await n.e(423).then(n.t.bind(n,7423,19))).CptvPlayerContext:(await n.e(711).then(n.bind(n,6711))).CptvPlayerContext,c=!0)}async initWithCptvUrlAndSize(e,t){const n=new s;await this.lockIsUncontended(n),this.locked=!0,this.framesRead=0,this.prevFrameHeader=null,this.streamError=void 0,await this.initWasm();try{if(this.consumed=!1,this.response=await fetch(e),200===this.response.status)return this.reader=this.response.body.getReader(),t||(t=Number(this.response.headers.get("Content-Length"))||0),this.expectedSize=t,this.playerContext=await i.newWithStream(this.reader),n.unlock(),this.inited=!0,this.locked=!1,!0;n.unlock(),this.locked=!1;try{const e=await this.response.json();return e.messages&&e.messages.pop()||e.message||"Unknown error"}catch(a){return await r.text()}}catch(a){return this.locked=!1,`Failed to load CPTV url ${e}, ${a}`}}async initWithCptvFile(e){const t=await a.readFile(e);return this.initWithFileBytes(t,e,!0)}async initWithFileBytes(e,t=""){this.framesRead=0,this.streamError=void 0;const r=new s;await this.lockIsUncontended(r),this.prevFrameHeader=null,this.locked=!0,await this.initWasm(),this.consumed=!1,this.reader=new o(e,1e5),this.expectedSize=e.length;try{return this.playerContext=await i.newWithStream(this.reader),r.unlock(),this.inited=!0,this.locked=!1,!0}catch(n){return this.streamError=n,r.unlock(),this.locked=!1,`Failed to load CPTV file ${t}, ${n}`}}async fetchNextFrame(){if(!this.reader)return console.warn("You need to initialise the player with the url of a CPTV file"),null;if(this.consumed)return console.warn("Stream has already been consumed and discarded"),null;const e=new s;if(await this.lockIsUncontended(e),this.locked=!0,this.playerContext&&this.playerContext.ptr)try{this.playerContext=await i.fetchNextFrame(this.playerContext)}catch(n){this.streamError=n}else console.warn("Fetch next failed");if(e.unlock(),this.locked=!1,this.hasStreamError())return null;const t=this.playerContext.getNextFrame(),r=this.playerContext.getFrameHeader();if(r&&32!==r.imageData.width){const e=r&&this.prevFrameHeader&&r.timeOnMs===this.prevFrameHeader.timeOnMs;if(e&&null===this.getTotalFrames())return this.prevFrameHeader=r,await this.fetchNextFrame();this.prevFrameHeader=r}return 0===t.length?null:(this.framesRead++,{data:new Uint16Array(t),meta:r})}async countTotalFrames(){if(!this.reader)return console.warn("You need to initialise the player with the url of a CPTV file"),0;const e=new s;if(await this.lockIsUncontended(e),this.locked=!0,this.playerContext&&this.playerContext.ptr){try{this.playerContext=await i.countTotalFrames(this.playerContext)}catch(t){this.streamError=t}this.consumed=!0}return e.unlock(),this.locked=!1,this.getTotalFrames()}async getMetadata(){const e=await this.getHeader();let t=0;if(this.hasStreamError())return this.streamError;{t=await this.countTotalFrames();const r=1/e.fps*t;return{...e,duration:r,totalFrames:t}}}async getBytesMetadata(e){return await this.initWithFileBytes(e,"",!!a),await this.getMetadata()}async getFileMetadata(e){return await this.initWithCptvFile(e),await this.getMetadata()}async getStreamMetadata(e,t){return await this.initWithCptvUrlAndSize(e,t),await this.getMetadata()}async lockIsUncontended(e){return new Promise((t=>{this.locked?e.fn=t:t()}))}async getHeader(){if(!this.reader)return"You need to initialise the player with the url of a CPTV file";const e=new s;if(await this.lockIsUncontended(e),this.locked=!0,this.playerContext&&this.playerContext.ptr&&(this.playerContext=await i.fetchHeader(this.playerContext)),this.playerContext&&this.playerContext.ptr){const t=this.playerContext.getHeader();return"Unable to parse header"===t&&(this.streamError=t),e.unlock(),this.locked=!1,t}return this.streamError}getTotalFrames(){return this.streamError?this.framesRead:!this.locked&&this.inited&&this.playerContext.ptr&&this.playerContext.streamComplete()?this.playerContext.totalFrames():null}getLoadProgress(){return!this.locked&&this.playerContext&&this.playerContext.ptr?this.playerContext.bytesLoaded()/this.expectedSize:null}hasStreamError(){return void 0!==this.streamError}}var u=n(4895);const l=u.parentPort||"undefined"!==typeof self&&self;if(l){const e=new d;l.addEventListener("message",(async({data:t})=>{switch(t.type){case"initWithUrl":{const r=await e.initWithCptvUrlAndSize(t.url);l.postMessage({type:t.type,data:r})}break;case"initWithUrlAndSize":{const r=await e.initWithCptvUrlAndSize(t.url,t.size);l.postMessage({type:t.type,data:r})}break;case"initWithPath":{const r=await e.initWithCptvFile(t.path);l.postMessage({type:t.type,data:r})}break;case"initWithLocalCptvFile":{const r=await e.initWithFileBytes(t.arrayBuffer);l.postMessage({type:t.type,data:r})}break;case"getBytesMetadata":{const r=await e.getBytesMetadata(t.arrayBuffer);l.postMessage({type:t.type,data:r})}break;case"getFileMetadata":{const r=await e.getFileMetadata(t.path);l.postMessage({type:t.type,data:r})}break;case"getStreamMetadata":{const r=await e.getStreamMetadata(t.url);l.postMessage({type:t.type,data:r})}break;case"getNextFrame":{const r=await e.fetchNextFrame();l.postMessage({type:t.type,data:r})}break;case"getTotalFrames":{const r=e.getTotalFrames();l.postMessage({type:t.type,data:r})}break;case"getLoadProgress":{const r=e.getLoadProgress();l.postMessage({type:t.type,data:r})}break;case"getHeader":{const r=await e.getHeader();l.postMessage({type:t.type,data:r})}break;case"hasStreamError":{const r=e.hasStreamError();l.postMessage({type:t.type,data:r})}break;case"getStreamError":{const r=e.streamError;l.postMessage({type:t.type,data:r})}break;default:return void l.postMessage(t)}}))}},4489:()=>{},4895:()=>{}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,exports:{}};return e[r](i,i.exports,n),i.exports}n.m=e,n.c=t,(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,a){if(1&a&&(r=this(r)),8&a)return r;if("object"===typeof r&&r){if(4&a&&r.__esModule)return r;if(16&a&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var s={};e=e||[null,t({}),t([]),t(t)];for(var o=2&a&&r;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>s[e]=()=>r[e]));return s["default"]=()=>r,n.d(i,s),i}})(),(()=>{n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}})(),(()=>{n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[]))})(),(()=>{n.u=e=>"CptvPlayerVue.umd.min."+e+".js"})(),(()=>{n.miniCssF=e=>{}})(),(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{n.p=""})(),(()=>{var e={146:1,372:1},t=t=>{var[r,i,s]=t;for(var o in i)n.o(i,o)&&(n.m[o]=i[o]);s&&s(n);while(r.length)e[r.pop()]=1;a(t)};n.f.i=(t,r)=>{e[t]||importScripts(n.p+n.u(t))};var r=("undefined"!==typeof self?self:this)["webpackChunkCptvPlayerVue"]=("undefined"!==typeof self?self:this)["webpackChunkCptvPlayerVue"]||[],a=r.push.bind(r);r.push=t})(),(()=>{var e,t,r,a,i,s,o,c,d,u,l,f,p,h,_,b,y,g,w,m,v,x,C,k,F,M,S,P,W,E,j,O,T,H,U,A,L,V,z={};var B={1307:function(){return{"./index_bg.js":{__wbindgen_object_drop_ref:function(t){return void 0===e&&(e=n.c[3303].exports),e["ug"](t)},__wbg_new_3ea8490cd276c848:function(e,r){return void 0===t&&(t=n.c[3303].exports),t["fL"](e,r)},__wbindgen_number_new:function(e){return void 0===r&&(r=n.c[3303].exports),r["pT"](e)},__wbg_newwithlength_90fbb2b2d057a3c0:function(e){return void 0===a&&(a=n.c[3303].exports),a["bF"](e)},__wbindgen_memory:function(){return void 0===i&&(i=n.c[3303].exports),i["oH"]()},__wbg_buffer_ebc6c8e75510eae3:function(e){return void 0===s&&(s=n.c[3303].exports),s["v3"](e)},__wbg_newwithbyteoffsetandlength_9eb3327abeac2c52:function(e,t,r){return void 0===o&&(o=n.c[3303].exports),o["MS"](e,t,r)},__wbg_new_68adb0d58759a4ed:function(){return void 0===c&&(c=n.c[3303].exports),c["qq"]()},__wbg_set_2e79e744454afade:function(e,t,r){return void 0===d&&(d=n.c[3303].exports),d["Hl"](e,t,r)},__wbindgen_string_new:function(e,t){return void 0===u&&(u=n.c[3303].exports),u["h4"](e,t)},__wbg_new_59cb74e423758ede:function(){return void 0===l&&(l=n.c[3303].exports),l["h9"]()},__wbg_stack_558ba5917b466edd:function(e,t){return void 0===f&&(f=n.c[3303].exports),f["Dz"](e,t)},__wbg_error_4bb6c2a97407129a:function(e,t){return void 0===p&&(p=n.c[3303].exports),p["kF"](e,t)},__wbg_read_2516fe8e4e56274e:function(e){return void 0===h&&(h=n.c[3303].exports),h["Xy"](e)},__wbg_then_ac66ca61394bfd21:function(e,t,r){return void 0===_&&(_=n.c[3303].exports),_["xI"](e,t,r)},__wbindgen_boolean_get:function(e){return void 0===b&&(b=n.c[3303].exports),b["HT"](e)},__wbindgen_is_undefined:function(e){return void 0===y&&(y=n.c[3303].exports),y["XP"](e)},__wbg_instanceof_Uint8Array_d7349a138407a31e:function(e){return void 0===g&&(g=n.c[3303].exports),g["QP"](e)},__wbg_byteLength_7d55aca7ec6c42cb:function(e){return void 0===w&&(w=n.c[3303].exports),w["tv"](e)},__wbg_length_317f0dd77f7a6673:function(e){return void 0===m&&(m=n.c[3303].exports),m["rX"](e)},__wbg_new_135e963dedf67b22:function(e){return void 0===v&&(v=n.c[3303].exports),v["XV"](e)},__wbg_set_4a5072a31008e0cb:function(e,t,r){return void 0===x&&(x=n.c[3303].exports),x["CV"](e,t,r)},__wbg_cptvplayercontext_new:function(e){return void 0===C&&(C=n.c[3303].exports),C["WA"](e)},__wbg_call_f5e0576f61ee7461:function(e,t,r){return void 0===k&&(k=n.c[3303].exports),k["S8"](e,t,r)},__wbg_get_0c6963cbab34fbb6:function(e,t){return void 0===F&&(F=n.c[3303].exports),F["et"](e,t)},__wbg_new_7031805939a80203:function(e,t){return void 0===M&&(M=n.c[3303].exports),M["SS"](e,t)},__wbindgen_object_clone_ref:function(e){return void 0===S&&(S=n.c[3303].exports),S["m_"](e)},__wbindgen_debug_string:function(e,t){return void 0===P&&(P=n.c[3303].exports),P["fY"](e,t)},__wbindgen_throw:function(e,t){return void 0===W&&(W=n.c[3303].exports),W["Or"](e,t)},__wbg_then_367b3e718069cfb9:function(e,t){return void 0===E&&(E=n.c[3303].exports),E["DN"](e,t)},__wbindgen_cb_drop:function(e){return void 0===j&&(j=n.c[3303].exports),j["G6"](e)},__wbg_resolve_778af3f90b8e2b59:function(e){return void 0===O&&(O=n.c[3303].exports),O["IL"](e)},__wbg_debug_3c0b82934d1dd91e:function(e){return void 0===T&&(T=n.c[3303].exports),T["bf"](e)},__wbg_error_9ff84d33a850b1ef:function(e){return void 0===H&&(H=n.c[3303].exports),H["Qw"](e)},__wbg_info_3b2058a219fa31b9:function(e){return void 0===U&&(U=n.c[3303].exports),U["Jn"](e)},__wbg_log_386a8115a84a780d:function(e){return void 0===A&&(A=n.c[3303].exports),A["IZ"](e)},__wbg_warn_5fc232d538408d4a:function(e){return void 0===L&&(L=n.c[3303].exports),L["QL"](e)},__wbindgen_closure_wrapper207:function(e,t,r){return void 0===V&&(V=n.c[3303].exports),V["Pn"](e,t,r)}}}}},I={711:[1307]};n.w={},n.f.wasm=function(e,t){var r=I[e]||[];r.forEach((function(r,a){var i=z[r];if(i)t.push(i);else{var s,o=B[r](),c=fetch(n.p+""+{711:{1307:"388a37586be01d76d0db"}}[e][r]+".module.wasm");if(o&&"function"===typeof o.then&&"function"===typeof WebAssembly.compileStreaming)s=Promise.all([WebAssembly.compileStreaming(c),o]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"===typeof WebAssembly.instantiateStreaming)s=WebAssembly.instantiateStreaming(c,o);else{var d=c.then((function(e){return e.arrayBuffer()}));s=d.then((function(e){return WebAssembly.instantiate(e,o)}))}t.push(z[r]=s.then((function(e){return n.w[r]=(e.instance||e).exports})))}}))}})();var a=n(8146);return a=a.default,a})()}));
//# sourceMappingURL=CptvPlayerVue.umd.min.146.js.map